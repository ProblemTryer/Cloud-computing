import os
import pandas as pd
import re
import numpy as np
from matplotlib import pyplot as plt


def file_name(file_dir):
    L = []
    for root, dirs, files in os.walk(file_dir):
        for file in files:
            if str.isdigit(os.path.splitext(file)[0]):
                L.append(os.path.join(root, file))
    return L


def data_cleaning_cow_id(file_dict):
    sensor_data_file = file_name(file_dict)

    for file in sensor_data_file:
        csv_data = pd.read_csv(file)
        data = pd.DataFrame(csv_data).drop(["heat_index", "stomach_temp"], axis=1)
        temp_dec_index = data[["temp_dec_index", "time"]].dropna()
        for column in columns:
            data[column] = data[column].apply(lambda x: x if np.isreal(x) else np.nan)
        data["temp_without_drink_cycles"] = data[data["temp_without_drink_cycles"]].apply(
            lambda x: x if (35 < x < 45) else np.nan)
        data["animal_activity"] = data[data["animal_activity"]].apply(lambda x: x if x < 0 else np.nan)

        # drop data with empty item in a row
        data = data.drop(columns=['temp_dec_index'], axis=1).dropna()
        return data


columns = ["act_heat_index_smart",
           "act_heat_index",
           "animal_activity",
           "low_pass_over_activity",
           "percentile60_of_5day_temp",
           "temp_height_index",
           "temp_inc_index",
           "temp_without_drink_cycles",
           "CowID"]


if __name__ == '__main__':
    file_dict = "E:/Cloud Computing/Project_4/"
    sensor_data = data_cleaning_cow_id(file_dict)
